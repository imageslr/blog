---
layout: post
title: ğŸ“ã€LeetCodeã€‘42 æ¥é›¨æ°´
date: 2020/2/21 14:00
permalink: 2020/02/21/leetcode-42.html
---

è¿™é“é¢˜æ˜¯ [LeetCode 42 é¢˜](https://leetcode-cn.com/problems/trapping-rain-water/)ã€‚

ç»™å®š n ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚

è¿™é“é¢˜ä¹ä¸€çœ‹å’Œ [LeetCode 84 æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢]({%- post_url 2020-02-02-leetcode-84 -%})å¾ˆåƒã€‚äº‹å®ä¸Šï¼Œ84 é¢˜çš„å¾ˆå¤šè§£æ³•éƒ½å¯ä»¥å¥—åˆ°è¿™é“é¢˜ä¸Šã€‚

## é€šç”¨çš„ä¼˜åŒ–æ–¹æ³•
è¿™é“é¢˜æœ‰ä¸€ä¸ªé€šç”¨çš„ä¼˜åŒ–æ–¹æ³•ã€‚æŠŠæŸ±å­æƒ³è±¡æˆä¸‹å›¾çš„æ›²çº¿ï¼Œé›¨æ°´åªèƒ½å­˜å‚¨åœ¨æŸ±å­ä¹‹é—´çš„â€œè°·â€é‡Œï¼Œå› æ­¤å¯ä»¥è·³è¿‡å·¦ä¾§å’Œå³ä¾§çš„ä¸Šå‡å¡ï¼Œåªéå†ä¸­é—´çš„æŸ±å­ã€‚
![-w550](/media/15822669497304.jpg)

å®šä¹‰ä¸¤ä¸ªå˜é‡ `left`ã€`right` åˆ†åˆ«è¡¨ç¤ºä¸Šå›¾ä¸¤ä¸ªè™šçº¿ï¼Œå§‹ç»ˆä»¤ `left` å³ä¾§é€’å‡ï¼Œ`right` å·¦ä¾§é€’å¢ï¼Œåªéœ€è¦éå†åŒºé—´ `[left,right]`ã€‚è¿™æ˜¯ä¸€ç§â€œåŒæŒ‡é’ˆâ€çš„æ€æƒ³ã€‚

è¿™ç§æƒ…å†µä¸‹ï¼Œ`left`ã€`right` æ˜¯ä¸€ä¸ªã€Œå³°å€¼ã€ï¼Œå³å®ƒä»¬æ¯”è‡ªå·±å·¦å³çš„æŸ±å­éƒ½é«˜ã€‚å½“ `left >= right` æ—¶ï¼Œè¯´æ˜æ‰€æœ‰æŸ±å­ä¸­å·²ç»ä¸å­˜åœ¨â€œè°·â€äº†ï¼Œå¯ä»¥ç»“æŸäº†ã€‚

```go
left, right := trimLeftRight(heights)
if left >= right {
	return res
}

func trimLeftRight(heights []int) (int, int) {
	n := len(heights)
	left, right := 0, n-1
	for left < right && heights[left] <= heights[left+1] {
		heights[left] = 0
		left++
	}
	for right > left && heights[right] <= heights[right-1] {
		heights[right] = 0
		right--
	}
	return left, right
}
```

## è§£æ³•ä¸€ï¼šæš´åŠ›ï¼ˆéå†ä¸åŒçš„é«˜åº¦ï¼‰
è¿™ç§è§£æ³•å¯¹åº”äº 84 é¢˜çš„[è§£æ³•ä¸€]({%- post_url 2020-02-02-leetcode-84 -%}#%E8%A7%A3%E6%B3%95%E4%B8%80%E6%9A%B4%E5%8A%9B%E9%81%8D%E5%8E%86%E4%B8%8D%E5%90%8C%E7%9A%84%E9%AB%98%E5%BA%A6)ï¼Œ
84 é¢˜çš„è§£æ³•ä¸€æ˜¯ä½¿ç”¨ä¸€æ ¹ä»ä¸‹åˆ°ä¸Šã€é€æ¸å‡é«˜çš„æ°´å¹³çº¿ï¼Œç»Ÿè®¡æ°´å¹³çº¿ä¸‹æ–¹çš„è¿ç»­çŸ©å½¢é¢ç§¯ã€‚è¿™é“é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æ€è·¯ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…ˆç»Ÿè®¡æ‰€æœ‰é«˜åº¦ä¸º 1 çš„é›¨æ°´çš„ä½“ç§¯ï¼Œç„¶åæ‰€æœ‰æŸ±å­é«˜åº¦éƒ½å‡ 1ï¼Œç»§ç»­é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰æŸ±å­é«˜åº¦ä¸º 0ã€‚

![-w432](/media/15822669884183.jpg)

åœ¨æ¯ä¸€è½®ç»Ÿè®¡ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨ä¸Šæ–‡æ‰€è¯´çš„ä¼˜åŒ–æ–¹æ³•ï¼Œè·³è¿‡åŒºé—´å·¦å³ä¾§çš„æ–œå¡ã€‚è¿™æ ·å¯ä»¥ä¿è¯ï¼šæ¯é‡åˆ°ä¸€ä¸ªé«˜åº¦ä¸º 0 çš„æŸ±å­ï¼Œå®ƒçš„ä¸Šæ–¹ä¸€å®šå¯ä»¥æ¥é›¨æ°´ï¼Œå·¦å³ä¸€å®šæœ‰æ¯”å®ƒé«˜çš„æŸ±å­ã€‚å› æ­¤åªè¦é‡åˆ°ä¸€ä¸ªé«˜åº¦ä¸º 0 çš„æŸ±å­ï¼Œé›¨æ°´æ€»é‡å°±å¢åŠ  1 å•ä½ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(mÃ—n)$ï¼Œm ä¸ºæŸ±å­çš„æœ€å¤§é«˜åº¦ï¼Œn ä¸ºæŸ±å­ä¸ªæ•°ã€‚  
ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚

æ‰§è¡Œç»“æœï¼š960 ms
```
315/315 cases passed (960 ms)
Your runtime beats 5.14 % of golang submissions
Your memory usage beats 100 % of golang submissions (2.8 MB)
```

ä»£ç ï¼š
```go
func trap(heights []int) int {
	if len(heights) == 0 {
		return 0
	}
	n := len(heights)
	m := 0
	for _, h := range heights {
		m = Max(m, h)
	}
	res := 0
	left, right := 0, n-1
	for ; m > 0; m-- {
		left, right = trimLeftRight(heights)
		if left >= right {
			return res
		}
		for i := left; i <= right; i++ {
			if heights[i] == 0 {
				res++
			} else {
				heights[i]--
			}
		}
	}
	return res
}
```

## è§£æ³•äºŒï¼šæš´åŠ›ï¼ˆéå†ä¸åŒçš„æŸ±å­ï¼‰
è¿™ç§è§£æ³•å¯¹åº”äº 84 é¢˜çš„[è§£æ³•å››]({%- post_url 2020-02-02-leetcode-84 -%}#%E8%A7%A3%E6%B3%95%E5%9B%9B%E6%9A%B4%E5%8A%9B%E9%81%8D%E5%8E%86%E4%B8%8D%E5%90%8C%E7%9A%84%E6%9F%B1%E5%AD%90)ï¼Œæ€è·¯æ˜¯ä¸€åˆ—ä¸€åˆ—åœ°æ±‚æ¯ä¸€åˆ—ä¸Šæ–¹èƒ½æ¥å¤šå°‘é›¨æ°´ã€‚

å¯¹äºæ¯ä¸€ä¸ªæŸ±å­ï¼Œåªéœ€è¦å‘å·¦ã€å‘å³æ‰¾åˆ°æœ€é«˜çš„æŸ±å­ï¼Œå¦‚æœå·¦å³æœ€é«˜çš„æŸ±å­éƒ½æ¯”å®ƒé«˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ±å­ä¸Šæ–¹ä¸€å®šå¯ä»¥æ¥åˆ°é›¨æ°´ã€‚èƒ½æ¥å¤šå°‘é›¨æ°´ï¼Œå–å†³äº**å·¦å³æœ€é«˜çš„æŸ±å­çš„è¾ƒå°å€¼**ã€‚è®¾æŸ±å­ `i` å·¦å³æœ€é«˜çš„æŸ±å­ä¸‹æ ‡åˆ†åˆ«ä¸º `left`ã€`right`ï¼Œåˆ™æŸ±å­ `i` å¯ä»¥æ¥é›¨æ°´ï¼š
```
Min(height[left], height[right]) - height[i]
```

ç›¸å½“äºä¾æ¬¡è®¡ç®—ä¸‹å›¾çº¢è‰²åŒºåŸŸçš„é¢ç§¯ï¼š  
![-w433](/media/15822677242095.jpg)

æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$ã€‚  
ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚

æ‰§è¡Œç»“æœï¼š80 ms
```
315/315 cases passed (80 ms)
Your runtime beats 11.68 % of golang submissions
Your memory usage beats 75.85 % of golang submissions (2.8 MB)
```

ä»£ç ï¼š
```go
func trap(heights []int) int {
	if len(heights) == 0 {
		return 0
	}

	left, right := trimLeftRight(heights)
	if left >= right {
		return 0
	}

	res := 0
	for i := left + 1; i <= right-1; i++ { // å·¦å³è¾¹ç•Œä¸Šä¸€å®šæ²¡é›¨æ°´
		hLeft, hRight := 0, 0
		for j := left; j < i; j++ {
			hLeft = Max(hLeft, heights[j])
		}
		for j := i + 1; j <= right; j++ {
			hRight = Max(hRight, heights[j])
		}
		h := heights[i]
		if hLeft > h && hRight > h {
			res += Min(hLeft, hRight) - h
		}
	}
	return res
}
```

## è§£æ³•ä¸‰ï¼šä½¿ç”¨çº¿æ®µæ ‘ä¼˜åŒ–è§£æ³•äºŒ
è§£æ³•äºŒéœ€è¦æŸ¥è¯¢åŒºé—´æœ€å€¼ï¼Œå¯ä»¥ä½¿ç”¨çº¿æ®µæ ‘æ¥ä¼˜åŒ–ï¼Œä»è€Œå°†æŸ¥è¯¢åŒºé—´æœ€å€¼çš„æ—¶é—´ç”± O(n) é™ä¸º O(logn)ã€‚84 é¢˜çš„[è§£æ³•ä¸‰]({%- post_url 2020-02-02-leetcode-84 -%})ä¹Ÿé‡‡ç”¨äº†è¿™ç§æ€è·¯ã€‚

å…³äºçº¿æ®µæ ‘çš„å®ç°ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘[ä¹‹å‰çš„æ–‡ç« ]({%- post_url 2020-02-02-segment -%})ã€‚æœ¬é¢˜çº¿æ®µæ ‘ä»…éœ€è¦æ„å»ºå’ŒæŸ¥è¯¢ï¼Œä¸éœ€è¦æ›´æ–°ï¼Œå®ç°å¹¶æ— éš¾åº¦ï¼Œéƒ½æ˜¯å¾ˆç®€å•çš„é€’å½’ã€‚å¼•å…¥çº¿æ®µæ ‘åï¼Œè§£æ³•äºŒåªéœ€è¦æ›´æ”¹ä¸¤è¡Œä»£ç ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(nlogn)$ã€‚  
ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œçº¿æ®µæ ‘çš„ç©ºé—´å¼€é”€ã€‚

æ‰§è¡Œç»“æœï¼šæ—¶é—´å¤§å¹…ç¼©çŸ­ï¼Œä»…éœ€ 8ms
```
315/315 cases passed (8 ms)
Your runtime beats 22.64 % of golang submissions
Your memory usage beats 5.1 % of golang submissions (4.3 MB)
```

ä»£ç ï¼š
```go
func trap(heights []int) int {
	if len(heights) == 0 {
		return 0
	}
	left, right := trimLeftRight(heights)
	if left >= right {
		return 0
	}

	res := 0
	sTree := BuildSegmentTree(heights, 0, len(heights)-1) // 1. æ„å»ºçº¿æ®µæ ‘
	for i := left + 1; i <= right-1; i++ {                // å·¦å³è¾¹ç•Œä¸Šä¸€å®šæ²¡é›¨æ°´
		hLeft := sTree.Query(left, i-1) // 2. ä½¿ç”¨ Query() æ–¹æ³•æŸ¥æ‰¾åŒºé—´æœ€å€¼
		hRight := sTree.Query(i+1, right)
		h := heights[i]
		if hLeft > h && hRight > h {
			res += Min(hLeft, hRight) - h
		}
	}
	return res
}

type SegmentTreeNode struct {
	start int
	end   int
	max   int
	left  *SegmentTreeNode
	right *SegmentTreeNode
}

func BuildSegmentTree(nums []int, left, right int) *SegmentTreeNode {
	if left > right {
		return nil
	}
	root := &SegmentTreeNode{left, right, nums[left], nil, nil} // æ ¹æ®èŠ‚ç‚¹åŒºé—´çš„å·¦è¾¹ç•Œå€¼åˆå§‹åŒ–
	if left == right {
		return root
	}
	mid := (left + right) / 2
	root.left = BuildSegmentTree(nums, left, mid)
	root.right = BuildSegmentTree(nums, mid+1, right)
	root.max = Max(root.left.max, root.right.max)
	return root
}

func (root *SegmentTreeNode) Query(start, end int) int {
	if start <= root.start && end >= root.end {
		return root.max
	}
	if start > root.end || end < root.start {
		return math.MinInt32
	}
	return Max(root.left.Query(start, end), root.right.Query(start, end))
}

func Min(a, b int) int {
	if a > b {
		return b
	}
	return a
}

func Max(a, b int) int {
	if a > b {
		return a
	}
	return b
}
```

## è§£æ³•å››ï¼šä½¿ç”¨åŠ¨æ€è§„åˆ’ä¼˜åŒ–è§£æ³•äºŒ
ä¼˜åŒ–éƒ¨åˆ†è¿˜æ˜¯å¦‚ä½•æ±‚å·¦å³åŒºé—´æœ€å€¼ã€‚

å¯¹äºè§£æ³•äºŒï¼Œæ±‚æ¯ä¸ªå…ƒç´ å·¦å³çš„æœ€å€¼æ—¶ï¼Œéƒ½ä¼šæ¶‰åŠå¾ˆå¤šé‡å¤è®¡ç®—ã€‚æ¯”å¦‚æ±‚ `i=3` å·¦ä¾§çš„æœ€å¤§å€¼ï¼Œéœ€è¦éå†å‰ 3 ä¸ªå…ƒç´ ï¼Œæ‰¾å‡ºæœ€å¤§å€¼ï¼›è€Œåœ¨æ±‚ `i=4` å·¦ä¾§çš„æœ€å¤§å€¼æ—¶ï¼Œåˆéœ€è¦éå†å‰ 4 ä¸ªå…ƒç´ ï¼Œæ‰¾å‡ºæœ€å¤§å€¼ã€‚ä½†æ­¤æ—¶æˆ‘ä»¬å‘ç°ï¼Œå‰ 3 ä¸ªå…ƒç´ ä¹‹å‰å·²ç»æ‰¾è¿‡æœ€å¤§å€¼äº†ï¼Œåªéœ€æ¯”è¾ƒ `å‰ 3 ä¸ªå…ƒç´ çš„æœ€å¤§å€¼` å’Œ `ç¬¬ 4 ä¸ªå…ƒç´ ` å“ªä¸ªå¤§å°±å¯ä»¥äº†ã€‚

è¿™æ˜¯ä¸€ç§åŠ¨æ€è§„åˆ’çš„æ€è·¯ï¼Œè®¾ `maxLeft[i]`ã€`maxRight[i]` åˆ†åˆ«è¡¨ç¤ºä¸‹æ ‡ i çš„æŸ±å­å·¦å³åŒºé—´çš„æœ€å¤§å€¼ï¼Œåˆ™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š
```
maxLeft[i] = Max(maxLeft[i-1], heights[i-1])
maxRight[i] = Max(maxRight[i+1], heights[i+1])
```

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚  
ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ã€‚

æ‰§è¡Œç»“æœï¼š0msï¼Œä¸æ„§æ˜¯ O(n) çš„è§£æ³•ï¼Œæ¯”çº¿æ®µæ ‘æ›´ä¼˜
```
315/315 cases passed (0 ms)
Your runtime beats 100 % of golang submissions
Your memory usage beats 14.63 % of golang submissions (3.1 MB)
```

ä»£ç ï¼š
```go
func trap(heights []int) int {
	if len(heights) == 0 {
		return 0
	}
	left, right := trimLeftRight(heights)
	if left >= right {
		return 0
	}

	n := len(heights)
	res := 0

	maxLeft, maxRight := make([]int, n), make([]int, n)
	maxLeft[0], maxRight[n-1] = 0, 0
	for i := 1; i < n; i++ {
		maxLeft[i] = Max(maxLeft[i-1], heights[i-1])
	}
	for i := n - 2; i >= 0; i-- {
		maxRight[i] = Max(maxRight[i+1], heights[i+1])
	}

	for i := left + 1; i <= right-1; i++ { // å·¦å³è¾¹ç•Œä¸Šä¸€å®šæ²¡é›¨æ°´
		hLeft, hRight := maxLeft[i], maxRight[i]
		h := heights[i]
		if hLeft > h && hRight > h {
			res += Min(hLeft, hRight) - h
		}
	}
	return res
}
```

## è§£æ³•äº”ï¼šä½¿ç”¨åŒæŒ‡é’ˆä¼˜åŒ–è§£æ³•å››
è§£æ³•å››çš„ç©ºé—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œä½†æ˜¯æ¯ä¸ª `maxLeft[i]` éƒ½åªè¢«ä½¿ç”¨äº†ä¸€æ¬¡ï¼ŒæŒ‰é“ç†å¯ä»¥ä¼˜åŒ–ä¸º O(1)ã€‚

<details markdown="1">
<summary>&nbsp;</summary>
å›é¡¾äºŒç»´ dp æ•°ç»„ä¼˜åŒ–ä¸ºä¸€ç»´ dp æ•°ç»„çš„è¿‡ç¨‹ï¼šå¦‚æœä¸€ä¸ªä½ç½®çš„çŠ¶æ€ä¾èµ–äºå…¶å·¦ã€ä¸Šä¸¤ä¸ªä½ç½®çš„å€¼ï¼Œé‚£ä¹ˆåªéœ€é‡‡ç”¨â€œè¡Œä»ä¸Šåˆ°ä¸‹ã€åˆ—ä»å·¦åˆ°å³â€çš„é¡ºåºéå†æ¯ä¸ªä½ç½®ã€‚åä¹‹ï¼Œå¦‚æœä¾èµ–çš„æ˜¯å³ã€ä¸Šçš„å€¼ï¼Œé‚£éœ€è¦é‡‡ç”¨â€œè¡Œä»ä¸Šåˆ°ä¸‹ã€åˆ—ä»å³åˆ°å·¦â€çš„é¡ºåºéå†æ¯ä¸ªä½ç½®ã€‚

![-w456](/media/15822671498196.jpg)

åˆ†ææˆ‘ä»¬ä¸ºä»€ä¹ˆé‡‡ç”¨è¿™ç§é¡ºåºã€‚åœ¨äºŒç»´æ•°ç»„é‡Œï¼Œæ›´æ–°æ¯ä¸ªä½ç½® `dp[i][j]` æ—¶ï¼Œéœ€è¦çŸ¥é“ `dp[i-1][j]` å’Œ `dp[i][j-1]`ã€‚è€Œå‹ç¼©ä¸ºä¸€ç»´æ•°ç»„åï¼Œä¸€ç»´æ•°ç»„çš„æ¯ä¸ªä½ç½® `dp[j]` åœ¨æ›´æ–°å‰å°±ç›¸å½“äºäºŒç»´æ•°ç»„çš„ `dp[i-1][j]`ï¼Œåœ¨æ›´æ–°åç›¸å½“äº `dp[i][j]`ã€‚

![-w456](/media/15822671591682.jpg)

</details>

åœ¨è¿™é“é¢˜ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸€ç»´ dp æ•°ç»„ï¼Œ`maxLeft[]` ä»å·¦åˆ°å³æ›´æ–°ï¼Œ`maxRight[]` ä»å³åˆ°å·¦æ›´æ–°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![-w391](/media/15822671666569.jpg)

å¦‚æœä»å·¦åˆ°å³éå†ï¼Œé‚£åªèƒ½å°† `maxLeft[]` å‹ç¼©ä¸ºä¸€ä¸ªå˜é‡ï¼š
```go
maxRight := make([]int, n) // maxRight è¿˜æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„
maxRight[n-1] = heights[n-1]
for i := n-2; i >= 0; i-- { // éœ€è¦æå‰ä»å³å¾€å·¦éå†ï¼Œæ±‚å‡ºæ¯ä¸ª maxRight[i]
    maxRight[i] = Max(maxRight[i+1], heights[i+1])
}
maxLeft := heights[0] // maxLeft å‹ç¼©ä¸ºä¸€ä¸ªå˜é‡
for i := 1; i < n; i++ {
    maxLeft = Max(maxLeft, heights[i-1])
    // ...
}
```
åä¹‹ï¼Œå¦‚æœä»å³åˆ°å·¦éå†ï¼Œé‚£åªèƒ½å°† `maxRight[]` å‹ç¼©ä¸ºä¸€ä¸ªå˜é‡ã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›åŒæ—¶å°† `maxLeft[]`ã€`maxRight[]` å‹ç¼©ä¸ºä¸¤ä¸ªå˜é‡ `maxLeft`ã€`maxRight`ï¼Œé‚£åº”è¯¥é‡‡ç”¨ä½•ç§é¡ºåºéå†ï¼Ÿç­”æ¡ˆæ˜¯**åŒæ—¶ä»å·¦å³ä¸¤ä¸ªæ–¹å‘éå†**ã€‚

**å¼•å…¥ä¸¤ä¸ªæŒ‡é’ˆ `left` å’Œ `right`ï¼Œä»ä¸¤ä¸ªæ–¹å‘éå†**ã€‚å®šä¹‰ `maxLeft` è¡¨ç¤ºæŸ±å­ `left` å·¦ä¾§çš„æœ€å¤§é«˜åº¦ï¼Œ`maxRight` è¡¨ç¤ºæŸ±å­ `right` å³ä¾§çš„æœ€å¤§é«˜åº¦ã€‚

è®¡ç®—æ¯ä¸ªæŸ±å­èƒ½æ¥å¤šå°‘é›¨æ°´ï¼Œåªéœ€è¦çŸ¥é“å·¦å³ä¸¤ä¾§æœ€é«˜æŸ±å­çš„**æœ€å°å€¼**ã€‚å› æ­¤ï¼Œå¦‚æœ `maxLeft <= maxRight`ï¼Œé‚£ä¹ˆå¯ä»¥è‚¯å®šæŸ±å­ `left` å³ä¾§çš„æœ€å¤§é«˜åº¦ä¸€å®š **å¤§äºç­‰äº** `maxRight`ï¼Œå› æ­¤æŸ±å­ `left` å·¦å³ä¸¤ä¾§æœ€é«˜æŸ±å­çš„æœ€å°å€¼ä¸€å®šæ˜¯ `maxLeft`ã€‚

åŒç†ï¼Œå¦‚æœ `maxLeft >= maxRight`ï¼Œé‚£ä¹ˆå¯ä»¥è‚¯å®šæŸ±å­ `right` å·¦ä¾§çš„æœ€å¤§é«˜åº¦ä¸€å®š **å¤§äºç­‰äº** `maxLeft`ï¼Œå› æ­¤æŸ±å­ `right` å·¦å³ä¸¤ä¾§æœ€é«˜æŸ±å­çš„æœ€å°å€¼ä¸€å®šæ˜¯ `maxRight`ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥**æ ¹æ® `maxLeft` ä¸ `maxRight` çš„å¤§å°å…³ç³»ï¼Œé€‰æ‹©æ˜¯ä»å·¦åˆ°å³éå†ï¼Œè¿˜æ˜¯ä»å³åˆ°å·¦éå†**ã€‚å¦‚æœ `maxLeft <= maxRight`ï¼Œåˆ™ `left` å³ç§»ï¼ŒåŒæ—¶æ›´æ–° `maxLeft`ï¼›å¦åˆ™ï¼Œ`right` å·¦ç§»ï¼ŒåŒæ—¶æ›´æ–° `maxRight`ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚  
ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ã€‚

æ‰§è¡Œç»“æœï¼šåŒè§£æ³•å››ã€‚

ä»£ç :
```go
func trap(heights []int) int {
	if len(heights) == 0 {
		return 0
	}
	left, right := trimLeftRight(heights)
	if left >= right {
		return 0
	}

	res := 0
	left, right = left+1, right-1                          // å·¦å³è¾¹ç•Œä¸€å®šæ— æ³•æ¥é›¨æ°´
	maxLeft, maxRight := heights[left-1], heights[right+1] // åˆå§‹åŒ–
	for left <= right {
		if maxLeft <= maxRight { // ä»å·¦å‘å³
			h := heights[left]
			if maxLeft > h {
				res += maxLeft - h
			}
			maxLeft = Max(maxLeft, h)
			left++
		} else { // ä»å³å‘å·¦
			h := heights[right]
			if maxRight > h {
				res += maxRight - h
			}
			maxRight = Max(maxRight, h)
			right--
		}
	}
	return res
}
```

## è§£æ³•å…­ï¼šå•è°ƒæ ˆ
è¿™ç§è§£æ³•å¯¹åº”äº 84 é¢˜[è§£æ³•äº”]({% post_url 2020-02-02-leetcode-84%}#%E8%A7%A3%E6%B3%95%E4%BA%94%E5%8D%95%E8%B0%83%E6%A0%88)ã€‚åœ¨ 84 é¢˜çš„è§£æ³•äº”ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å•è°ƒæ ˆæ‰¾åˆ°æŸä¸ªæŸ±å­**å·¦å³ç¬¬ä¸€ä¸ªæ¯”å®ƒçŸ®**çš„æŸ±å­ã€‚è€Œåœ¨è¿™é“é¢˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•è°ƒæ ˆæ‰¾åˆ°æŸä¸ªæŸ±å­**å·¦å³ç¬¬ä¸€ä¸ªæ¯”å®ƒé«˜çš„æŸ±å­**ã€‚æ€è·¯å’Œ 84 é¢˜è§£æ³•äº”ä¸€æ¨¡ä¸€æ ·ï¼åªæ˜¯å•è°ƒæ ˆç”±é€’å¢å˜ä¸ºäº†é€’å‡ã€‚

å¦‚æœæˆ‘ä»¬èƒ½ä¾æ¬¡æ±‚å‡ºä¸‹å›¾çº¢è‰²åŒºåŸŸçš„é¢ç§¯ï¼Œé‚£ä¹ˆå°±èƒ½å¾—åˆ°é›¨æ°´çš„æ€»é‡ï¼š

![-w428](/media/15822672022249.jpg)

ä¸‹é¢æ¨å¯¼å¦‚ä½•è®¡ç®—å…¶ä¸­æ¯ä¸€ä¸ªçº¢è‰²åŒºåŸŸçš„é¢ç§¯ã€‚

è®¾å•è°ƒæ ˆä¿å­˜æŸ±å­çš„ä¸‹æ ‡ï¼Œä»å·¦åˆ°å³éå†æ¯ä¸ªæŸ±å­ã€‚å¦‚æœå½“å‰æŸ±å­ `i` çš„é«˜åº¦å¤§äºæ ˆé¡¶å…ƒç´ çš„é«˜åº¦ï¼Œåˆ™æ ˆé¡¶å…ƒç´  `stack[top]` **å³ä¾§**ç¬¬ä¸€ä¸ªæ¯”å®ƒé«˜çš„æŸ±å­çš„ä¸‹æ ‡å°±æ˜¯ `i`ï¼Œ**å·¦ä¾§**ç¬¬ä¸€ä¸ªæ¯”å®ƒé«˜çš„æŸ±å­çš„ä¸‹æ ‡å°±æ˜¯ `stack[top-1]`ã€‚

ä»¤ `left = stack[top-1]`ï¼Œ`right = i`ï¼Œ`top = stack[top]`ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥è®¡ç®—å‡º `left`ã€`right`ã€`top` ä¸‰æ ¹æŸ±å­åŒ…å›´çš„é›¨æ°´é‡ä¸ºï¼š
```go
(Min(heights[left], heights[right]) - heights[top]) Ã— (right-left-1)
```

![-w235](/media/15822672086154.jpg)

**ç®—æ³•æµç¨‹**å¯ä»¥è¡¨è¿°ä¸ºï¼š
1. ä»å·¦åˆ°å³éå†æ‰€æœ‰å…ƒç´ 
2. å¦‚æœå½“å‰å…ƒç´ çš„é«˜åº¦å°äºç­‰äºæ ˆé¡¶å…ƒç´ çš„é«˜åº¦ï¼Œå°±å°†å½“å‰ä¸‹æ ‡å…¥æ ˆ
3. å¦åˆ™ï¼Œä¸æ–­å°†æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼ŒåŒæ—¶æ ¹æ®ä¸Šè¿°å…¬å¼è®¡ç®—é›¨æ°´é‡
4. é‡å¤ç¬¬ 3 æ­¥ï¼Œç›´åˆ°å½“å‰å…ƒç´ çš„é«˜åº¦ä¸å¤§äºæ ˆé¡¶å…ƒç´ çš„é«˜åº¦ï¼Œç„¶åå°†å½“å‰ä¸‹æ ‡å…¥æ ˆ

**æ³¨æ„**ï¼šç¬¬ 3 æ­¥å¼¹å‡ºæ ˆé¡¶å…ƒç´ åï¼Œå¿…é¡»åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºã€‚åªæœ‰**å¼¹å‡ºä¸€ä¸ªå…ƒç´ å**æ ˆä¸ä¸ºç©ºï¼Œæ‰èƒ½ä¿è¯å¼¹å‡ºå…ƒç´ å·¦ä¾§æœ‰æ¯”å®ƒæ›´é«˜çš„å…ƒç´ ï¼Œè¿™æ—¶æ‰èƒ½æ¥åˆ°é›¨æ°´ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚
ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ã€‚

æ‰§è¡Œç»“æœï¼šåŒè§£æ³•å››ã€‚

ä»£ç ï¼š
```go
func trap(heights []int) int {
	if len(heights) == 0 {
		return 0
	}
	left, right := trimLeftRight(heights)
	if left >= right {
		return 0
	}

	res := 0
	stack := NewStack()
	for i := left; i <= right; i++ { // ä» 1 å¼€å§‹éå†
		for !stack.Empty() && heights[i] > heights[stack.Top()] {
			h := heights[stack.Pop()] // å¼¹å‡ºæ ˆé¡¶å…ƒç´ 
			if stack.Empty() {        // å¼¹å‡ºå…ƒç´ åæ ˆä¸èƒ½ä¸ºç©º
				break
			}
			left, right := stack.Top(), i
			res += (Min(heights[left], heights[right]) - h) * (right - left - 1)
		}
		stack.Push(i)
	}
	return res
}

// ä»¥ä¸‹æ˜¯æ ˆçš„æ¨¡æ¿ä»£ç 

type ElementType = int
type Stack struct {
	s []ElementType
}

func NewStack() *Stack {
	return &Stack{
		s: make([]ElementType, 0),
	}
}

func (s *Stack) Empty() bool {
	return len(s.s) == 0
}

func (s *Stack) Top() ElementType {
	if s.Empty() {
		return 0
	}
	return s.s[len(s.s)-1]
}

func (s *Stack) Pop() ElementType {
	if s.Empty() {
		return 0
	}
	t := s.s[len(s.s)-1]
	s.s = s.s[:len(s.s)-1]
	return t
}

func (s *Stack) Push(v ElementType) {
	s.s = append(s.s, v)
}
```

## æ€»ç»“
æœ¬æ–‡æä¾›äº† 6 ç§è§£æ³•ï¼Œè§£æ³•äºŒåˆ°è§£æ³•å…­éƒ½å¯ä»¥çœ‹ä½œåŒä¸€ç§æ€è·¯ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯ç›¸åŒçš„æ€è·¯ï¼Œé‡‡ç”¨ä¸åŒçš„æ–¹æ³•å®ç°ï¼Œä¹Ÿä¼šæœ‰ä¸åŒçš„æ—¶é—´æ•ˆç‡ã€‚

æœ¬é¢˜æ¶‰åŠçº¿æ®µæ ‘ã€åŠ¨æ€è§„åˆ’ã€å•è°ƒæ ˆçš„åº”ç”¨ï¼Œå€¼å¾—ç»†ç»†å“å‘³ã€‚åŒæ—¶ï¼Œæœ¬é¢˜çš„å¤§éƒ¨åˆ†è§£æ³•éƒ½å’Œ [84 é¢˜çš„è§£æ³•]({post_url 2020-02-02-leetcode-84 %})ä¸€ä¸€å¯¹åº”ï¼ŒåŒä¸€ç§è§£æ³•åœ¨ä¸åŒçš„é¢˜ç›®é—´ä¸¾ä¸€åä¸‰ï¼Œæ›´èƒ½åŠ æ·±ç†è§£ã€‚å¤§å®¶ä¹Ÿå¯ä»¥å»çœ‹çœ‹ 84 é¢˜ã€‚

æœ¬æ–‡å‘è¡¨åœ¨æˆ‘çš„åšå®¢ [https://imageslr.com](https://imageslr.com)ã€‚æˆ‘ä¹Ÿä¼šåˆ†äº«æ›´å¤šçš„é¢˜è§£ï¼Œä¸€èµ·äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼
