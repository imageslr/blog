---
layout: post
title: ğŸ“ºã€ç›‘æ§ã€‘ç ”å‘åŸºæœ¬åŠŸ - Grafana ä½¿ç”¨æŒ‡å—
date: 2024/1/20 18:00
typora-root-url: ../
typora-copy-images-to: ../media/grafana
---







## ã€‡ã€å‰è¨€

Grafana æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®å¯è§†åŒ–å’Œç›‘æ§å¹³å°ã€‚å®ƒæä¾›äº†ä¸€ä¸ªçµæ´»ä¸”å¼ºå¤§çš„ç•Œé¢ï¼Œå¯ä»¥è¿æ¥åˆ°å„ç§ä¸åŒç±»å‹çš„æ•°æ®æºï¼Œå°†å…¶ä¸­çš„æ•°æ®ä»¥å›¾è¡¨çš„å½¢å¼è¿›è¡Œå±•ç¤ºå’Œåˆ†æã€‚

Grafana çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ä½¿å…¶æˆä¸ºä¸€ä¸ªå¼ºæœ‰åŠ›çš„**æœåŠ¡è¿ç»´å·¥å…·**å’Œ**ä¿¡æ¯è·å–å·¥å…·**ï¼š
- æœåŠ¡è¿ç»´ï¼šå±•ç¤ºæœåŠ¡çš„å·¥ç¨‹æŒ‡æ ‡ï¼Œå¦‚ CPU åˆ©ç”¨ç‡ã€ååã€é”™è¯¯ç‡ç­‰ã€‚
- ä¿¡æ¯è·å–ï¼šå±•ç¤ºæœåŠ¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¦‚å®æ—¶åœ¨çº¿äººæ•°ã€è®¢å•æ•°ç­‰ã€‚

é…ç½®å¥½ Grafana çœ‹æ¿ï¼Œå¯ä»¥æå‡é—®é¢˜æ’æŸ¥çš„æ•ˆç‡ï¼šç›´æ¥åœ¨ Grafana æŸ¥çœ‹å„ç±»æ•°æ®ï¼Œæ— éœ€è·³è½¬åˆ°æ•°æ®æºï¼›ä¹Ÿå¯ä»¥å‘ç°äº‹ä»¶ä¹‹é—´çš„å…³è”ï¼Œä¾‹å¦‚â€œCPU åˆ©ç”¨ç‡å˜é«˜ï¼Œæ˜¯å› ä¸ºè¯·æ±‚é‡æ¶¨äº†â€ã€‚

æœ¬æ–‡å›´ç»• Grafana åœ¨åç«¯å¼€å‘ä¸­çš„é«˜é¢‘ä½¿ç”¨åœºæ™¯ï¼Œåˆ†äº«äº† Grafana çš„åŸºç¡€æ¦‚å¿µã€å¯è§†åŒ–ã€é«˜çº§åŠŸèƒ½ç­‰ã€‚ç›®æ ‡æ˜¯è®©è¯»è€…çŸ¥é“ Grafana æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œå…ˆç•™ä¸‹å°è±¡ï¼Œç„¶ååœ¨éœ€è¦é…ç½®çœ‹æ¿æ—¶éšæ—¶æŸ¥é˜…ã€‚æœ¬æ–‡åŒæ—¶æä¾›äº†ä¸€ä¸ªæ¶µç›–å…¨æ–‡å†…å®¹çš„ Grafana çœ‹æ¿ç¤ºä¾‹ã€‚

**å­¦ä¹  Grafana çš„æœ€å¥½æ–¹å¼æ˜¯äº²è‡ªä¸Šæ‰‹æ“ä½œ**ã€‚æœ¬æ–‡ä½¿ç”¨ Grafana å®˜æ–¹ç½‘ç«™æä¾›çš„[æ²™ç›’ç¯å¢ƒ](https://play.grafana.org/d/000000012/)åšæ¼”ç¤ºã€‚Grafana çš„æ²™ç›’ç¯å¢ƒæä¾›äº†ä¸€ä¸ª[æµ‹è¯•æ•°æ®æº](https://grafana.com/docs/grafana/latest/datasources/testdata/)ï¼Œå¯ä»¥å£°æ˜å¼åœ°ç”Ÿæˆéšæœºæ—¶åºæ•°æ®ï¼Œç”¨äºè°ƒè¯•çœ‹æ¿çš„åŠŸèƒ½ã€‚



<div class="ant-alert ant-alert" markdown="1">
ğŸ’¡ æ¼”ç¤ºç‰ˆæœ¬ï¼šGrafana v10.3.0
{: .mb-0}
* Grafana Sandboxï¼š<https://play.grafana.org/d/000000012/>
* Grafana å®˜ç½‘ï¼š<https://grafana.com/grafana/>
* Grafana å®˜æ–¹æä¾›çš„æ‰€æœ‰ç¤ºä¾‹ï¼š<https://play.grafana.org/dashboards>

</div>



### Grafana ç•Œé¢æ€»è§ˆ

![image-20240121161253079](/media/grafana/image-20240121161253079.png)

* â‘ ï¼šDashboard æ“ä½œåŒº (æ·»åŠ  Panelã€è®¾ç½®ã€ä¿å­˜)ã€‚
* â‘¡ï¼šæ—¶é—´èŒƒå›´é€‰æ‹©åŒºã€‚
* â‘¢ï¼šè‡ªåŠ¨åˆ·æ–°å‘¨æœŸã€‚
* â‘£ï¼šå˜é‡é€‰æ‹©åŒºï¼Œè§ä¸‹æ–‡ Variables**ï¼ˆTODOï¼‰**ã€‚
* â‘¤ï¼šé“¾æ¥åŒºï¼Œè§ä¸‹æ–‡ Linksï¼ˆ**TODOï¼‰**ã€‚
* â‘¥ï¼šDashboard å†…å®¹åŒºï¼ŒåŒ…å«å¤šä¸ª Rowsï¼Œæ¯ä¸ª Row ä¸‹é¢æœ‰å¤šä¸ª Panelsã€‚





## ä¸€ã€åŸºç¡€

### 1. URL / é“¾æ¥

ä¸€ä¸ª Grafana çœ‹æ¿çš„é“¾æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š

```plaintext
https://play.grafana.org/d/000000012/grafana-play-home?orgId=1
```

ä»å‰å¾€åä¾æ¬¡ï¼š

* `/d` è¡¨ç¤º Dashboardï¼Œç›¸åº”çš„ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ (Folder)ï¼Œé‚£ä¹ˆè¿™é‡Œæ˜¯ `/f`ï¼š

  ```plaintext
  https://play.grafana.org/dashboards/f/QQTPJnF4z/
  ```

* `000000012`æ˜¯è¿™ä¸ªçœ‹æ¿çš„å”¯ä¸€`ID`ï¼Œåœ¨æ•´ä¸ªç³»ç»Ÿä¸­ä¸èƒ½é‡å¤ã€‚

* `grafana-play-home` æ˜¯è¿™ä¸ªçœ‹æ¿çš„åç§°ã€‚å¦‚æœæ˜¯ä¸­æ–‡åç§°ï¼Œä¼šè‡ªåŠ¨è½¬æˆæ‹¼éŸ³ã€‚çœ‹æ¿çš„åç§°å¯ä»¥éšä¾¿æ”¹ï¼Œä¹Ÿå¯ä»¥é‡å¤ã€‚åªè¦ URL é‡Œæœ‰ `ID` å°±èƒ½å”¯ä¸€å®šä½ä¸€ä¸ª Grafana çœ‹æ¿ï¼Œåç§°éƒ¨åˆ†æ²¡æœ‰ä¹Ÿæ²¡å…³ç³»ã€‚

* `?orgId=1` æ˜¯çœ‹æ¿çš„å‚æ•°éƒ¨åˆ†ã€‚æ‰€æœ‰å˜é‡ / å‚æ•°ä¼šé€šè¿‡ `&` è¿æ¥ã€‚



æ¯æ¬¡ä¿®æ”¹çœ‹æ¿çš„å˜é‡å€¼ï¼ˆ**TODO é“¾æ¥**ï¼‰ï¼Œurl é‡Œå°±ä¼šå¢åŠ å½¢å¦‚ `var-aaa=xxx&var-bbb=xxx` çš„å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯å½“å‰çœ‹æ¿çš„**æ‰€æœ‰å˜é‡**çš„å–å€¼ï¼š

![image-20240121150637119](/media/grafana/image-20240121150637119.png)



æ¯æ¬¡ä¿®æ”¹çœ‹æ¿å³ä¸Šè§’çš„æ—¶é—´èŒƒå›´ï¼Œæˆ–è€…é¼ æ ‡æ‹–åŠ¨æ¡†é€‰ä¸€æ®µæ—¶é—´è½´ï¼Œurl é‡Œå°±ä¼šå¢åŠ å½¢å¦‚ `from=xxx&to=xxx` çš„å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯å½“å‰çœ‹æ¿çš„**æ—¶é—´æˆ³**èŒƒå›´ï¼š

```plaintext
https://play.grafana.org/d/000000012/grafana-play-home?orgId=1&from=1689073420099&to=1689076407767
```



ğŸ’¡ å¦‚æœä½ çš„ç›®çš„æ˜¯å¸Œæœ›å…¶ä»–äººèƒ½å¤Ÿè¿˜åŸç°åœºï¼Œé‚£ä¹ˆéœ€è¦åˆ†äº«å¸¦æœ‰æ—¶é—´èŒƒå›´å’Œå˜é‡å–å€¼çš„å®Œæ•´ URLã€‚å¦åˆ™ï¼Œåªéœ€è¦åˆ†äº«å¸¦æœ‰ `/d/{unique_id}` çš„ URLï¼Œæ¯”å¦‚ <https://play.grafana.org/d/000000012>ã€‚
{: .ant-alert .ant-alert-info}



### 2. JSON Model

Grafana çš„æ•´ä¸ªçœ‹æ¿å†…å®¹ â€”â€” åŒ…æ‹¬æ‰€æœ‰çš„è®¾ç½®é¡¹ â€”â€” éƒ½æ˜¯ç”¨ **JSON** æè¿°çš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥ç¼–è¾‘ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ¥è¾¾åˆ°ä¿®æ”¹çœ‹æ¿çš„ç›®çš„ã€‚æŸäº›åœºæ™¯ä¸‹ï¼Œè¿™æ¯”æ“ä½œ UI ç•Œé¢æ›´æ–¹ä¾¿ã€‚



å¯ä»¥åœ¨â€œDashboard Settings - JSON Modelâ€æ‰¾åˆ°å½“å‰çœ‹æ¿çš„ JSONï¼š

![image-20240121151125411](/media/grafana/image-20240121151125411.png)



JSON Model ä¸­çš„å­—æ®µè¯´æ˜ï¼š

- `iteration`ï¼šåœ¨ä»€ä¹ˆæ—¶é—´è¢«ä¿®æ”¹ã€‚Grafana é€šè¿‡è¿™ä¸ªå­—æ®µæ¥åˆ¤æ–­æ˜¯å¦å’Œå…¶ä»–äººçš„ä¿®æ”¹å‘ç”Ÿå†²çªã€‚
- `id`ã€`uid`ï¼šçœ‹æ¿çš„å”¯ä¸€æ ‡è¯†ï¼Œå³ URL ä¸­çš„ `ID` éƒ¨åˆ†ã€‚
- `links`ï¼šçœ‹æ¿ä¸Šé¢çš„é“¾æ¥

- `templating`ï¼šçœ‹æ¿çš„å˜é‡ Variables
- `panels`ï¼šç±»å‹æ˜¯æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ è¡¨ç¤ºé¡µé¢ä¸­çš„ä¸€ä¸ªé¢æ¿ (Panelï¼Œ`type=graph`)ï¼Œæˆ–è€…ä¸€è¡Œ (Rowï¼Œ`type=row`)ã€‚

- æ‰€æœ‰å­—æ®µè¯´æ˜ï¼š<https://grafana.com/docs/grafana/latest/dashboards/json-model/>



JSON Model çš„å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š

* å¤åˆ¶æ•´ä¸ª Dashboard
* æ‰¹é‡å¤åˆ¶æˆ–ä¿®æ”¹å¤šä¸ª Panels
* æ‰¹é‡æ›¿æ¢æ‰€æœ‰ Panels çš„ DataSource æˆ– Metrics å‰ç¼€



ğŸ’¡ å¯ä»¥ç›´æ¥åœ¨ VS Code ç­‰ç¼–è¾‘å™¨é‡Œä¿®æ”¹ JSON Modelï¼Œä¹Ÿå¯ä»¥ç”¨ JavaScript æˆ– Python ä»£ç ä¿®æ”¹ã€‚ä¿®æ”¹åçš„å†…å®¹ç²˜è´´åˆ°è®¾ç½®é¡µï¼Œä¿å­˜å³å¯ç”Ÿæ•ˆã€‚ä½†è¦æ³¨æ„ï¼Œä»¥ä¸‹å‡ ä¸ªå­—æ®µå¿…é¡»ä½¿ç”¨åŸæ¥çš„å€¼ï¼Œä¸èƒ½éšæ„æ›¿æ¢ï¼š`id`ã€`uid`ã€`iteration`ã€‚å¦åˆ™ä¼šæŠ¥é”™ï¼šâ€œDashboard has been changed by someone elseâ€ã€‚
{: .ant-alert .ant-alert-info}



### 3. ç‰ˆæœ¬æ§åˆ¶

åœ¨â€œDashboard Settings - Versionsâ€å¯ä»¥çœ‹åˆ°æœ€è¿‘çš„æ›´æ”¹å†å²ï¼Œå¯ä»¥å›æ»šã€‚

![image-20240121160708350](/media/grafana/image-20240121160708350.png)



### 4. æ–‡ä»¶å¤¹ / æƒé™æ§åˆ¶

Grafana çš„æƒé™æ§åˆ¶éµå¾ª RBAC ç­–ç•¥ã€‚



Grafana æä¾›ä»¥ä¸‹ä¸‰ç§è§’è‰²ï¼š

* Viewerï¼šå¯ä»¥æŸ¥çœ‹ä»ªè¡¨ç›˜ï¼Œä½†ä¸èƒ½ä¿®æ”¹
* Editorï¼šå¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹ä»ªè¡¨ç›˜
* Adminï¼šå¯ä»¥ç®¡ç†æ•´ä¸ªä»ªè¡¨ç›˜ã€åˆ†é…æƒé™



Grafana çš„æƒé™å¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ä¸ªå±‚çº§é…ç½®ï¼š

* ä»ªè¡¨ç›˜ï¼šä¸€ä¸ª Dashboard æƒé™ã€‚
* æ–‡ä»¶å¤¹ï¼šä¸€ä¸ªæ–‡ä»¶å¤¹å¯ä»¥åŒ…å«å¤šä¸ª Dashboardã€‚æ‹¥æœ‰è¯¥æ–‡ä»¶å¤¹æƒé™çš„ç”¨æˆ·ï¼Œä¼šè‡ªåŠ¨æ‹¥æœ‰æ–‡ä»¶ä¸‹æ‰€æœ‰ä»ªè¡¨ç›˜çš„æƒé™ã€‚



åœ¨â€œDashboard Settings - Permissionsâ€å¯ä»¥ä¿®æ”¹ä»–äººæƒé™ã€‚æƒé™å¯ä»¥åˆ†é…ç»™ä¸ªäººæˆ–å›¢é˜Ÿã€‚

å¦‚æœæƒ³åˆ›å»ºä¸€ä¸ª"åªè¯»"çš„çœ‹æ¿ï¼Œåªéœ€è¦å°† Editor çš„æƒé™ä»`Edit`æ”¹æˆ`View`ã€‚



### 5. å¤åˆ¶ Dashboard

ğŸ’¡ ä¸ºäº†æ–¹ä¾¿ç»ƒä¹ å’Œä¿å­˜ï¼Œå¯ä»¥å…ˆæŠŠ Grafana å®˜æ–¹æ²™ç›’çœ‹æ¿å¤åˆ¶ä¸€ä»½ã€‚
{: .ant-alert .ant-alert-info}



(1) å¦‚æœæœ‰çœ‹æ¿çš„ç¼–è¾‘æƒé™ï¼Œè¿›å…¥çœ‹æ¿çš„è®¾ç½®é¡µï¼Œç‚¹å‡» `Save As...` å³å¯ï¼š
![image-20240121153633234](/media/grafana/image-20240121153633234.png)

(2) å¦‚æœæ²¡æœ‰ç¼–è¾‘æƒé™ï¼Œå¯ä»¥ç‚¹å‡»ã€ŒShare - Export - View JSONã€ï¼Œå¤åˆ¶ JSON Modelã€‚
![image-20240121153808991](/media/grafana/image-20240121153808991.png)

æ¥ä¸‹æ¥æœ‰ä¸¤ç§å¯¼å…¥æ–¹å¼ï¼š

â‘  æ–¹æ³•ä¸€ï¼š"New Dashboard - Import â†’ Import via dashboard JSON model"ï¼Œç²˜è´´ JSON Model å†…å®¹ï¼ŒLoadã€‚ç„¶åä¿®æ”¹ Name å’Œ UIDï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

<img src="/media/grafana/image-20240121154205507.png" alt="image-20240121154205507" width="500px"/>

<img src="/media/grafana/image-20240121154243996.png" alt="image-20240121154205507" width="500px"/>

â‘¡ æ–¹æ³•äºŒï¼šæ–°å»ºä¸€ä¸ªç©ºç™½çœ‹æ¿ï¼Œè¿›å…¥è¯¥çœ‹æ¿çš„ã€ŒDashboard Settings - JSON Modelã€ï¼Œä½¿ç”¨è¯¥çœ‹æ¿çš„ `id`ã€`uid`ã€`title`ã€`iteration` å­—æ®µçš„å€¼ï¼Œåˆå¹¶åˆ°åˆšæ‰å¤åˆ¶çš„ JSON Model ä¸­ï¼Œæ•´ä½“ç²˜è´´è¦†ç›–ï¼Œä¿å­˜ã€‚



### 6. å¤åˆ¶ Panel

å¦‚æœæœ‰ç¼–è¾‘æƒé™ï¼š

1. Panel èœå• â†’ More â†’ Copyï¼š

   ![image-20240121154733223](/media/grafana/image-20240121154733223.png)

2. Add panel â†’ Paste panel

   ![image-20240121155038233](/media/grafana/image-20240121155038233.png)




å¦‚æœæ²¡æœ‰ç¼–è¾‘æƒé™ï¼š

1. Panel èœå• â†’ Inspect â†’ Panel JSONï¼š
   ![image-20240121154904497](/media/grafana/image-20240121154904497.png)

2. å°†è¿™ä¸ª Panel JSON å¤åˆ¶åˆ°ç›®æ ‡ Dashboard çš„ JSON Model - Panels ä¸­ã€‚æˆ–è€…å‚è€ƒè¿™ä¸ª Panel JSONï¼Œæ‰‹åŠ¨é…ç½®ä¸€ä¸ªä¸€æ ·çš„ Panelã€‚



### 7. ä¿å­˜çœ‹æ¿é»˜è®¤çŠ¶æ€
{: #default}

çœ‹æ¿çš„æ‰€æœ‰çŠ¶æ€éƒ½å¯ä»¥è¢«ä¿å­˜ã€‚åŒ…æ‹¬ï¼š

- å½“å‰é€‰æ‹©çš„æ—¶é—´èŒƒå›´
- å½“å‰å„ä¸ªå˜é‡çš„å€¼
- å½“å‰æ¯ä¸€è¡Œæ˜¯å±•å¼€è¿˜æ˜¯æŠ˜å çš„
- å³ä¸Šè§’çš„è‡ªåŠ¨åˆ·æ–°å‘¨æœŸ



å»ºè®®ï¼š

1. å»ºè®®è®¾ç½®å¥½çœ‹æ¿çš„é»˜è®¤çŠ¶æ€ï¼Œæ¯”å¦‚ï¼šé€‰æ‹©æœ€è¿‘ 3 å°æ—¶ã€é€‰æ‹©é»˜è®¤æœºæˆ¿ã€å±•å¼€æ ¸å¿ƒæŒ‡æ ‡è¡Œã€å…¶ä»–è¡Œé»˜è®¤æŠ˜å ã€‚
2. ç‚¹å‡» Saveï¼Œå‹¾é€‰ä»¥ä¸‹ä¸¤é¡¹ï¼Œä¿å­˜çœ‹æ¿çš„é»˜è®¤çŠ¶æ€ï¼š

   ![image-20240121160835012](/media/grafana/image-20240121160835012.png)
3. åˆ†äº«ä»…å¸¦æœ‰ `/d/{unique_id}` çš„çº¯æ´ urlï¼Œæ¯”å¦‚ <https://play.grafana.org/d/000000012>



## äºŒã€å˜é‡ Variables

å˜é‡ (Variables) æ˜¯ Grafana çš„ä¸€é¡¹å¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥ç”¨äºåˆ›å»ºåŠ¨æ€çš„ã€å¯é…ç½®çš„ã€æ¨¡æ¿åŒ–çš„ä»ªè¡¨ç›˜ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ªé€šç”¨å¤§ç›˜ï¼Œç›‘æ§å¤šä¸ªæœåŠ¡ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºå•ç‹¬çš„çœ‹æ¿ã€‚

### 1. é…ç½®å˜é‡

#### å˜é‡ç±»å‹

å˜é‡å¯ä»¥åœ¨â€œDashboard Settings - Variablesâ€é…ç½®ã€‚

![image-20240121225242430](/media/grafana/image-20240121225242430.png)



Grafana æä¾›äº†å¤šç§å˜é‡ç±»å‹ï¼š

1. Queryï¼šä½¿ç”¨æ•°æ®æºçš„æŸ¥è¯¢è¯­è¨€ï¼ŒåŠ¨æ€è·å–å¯é€‰é¡¹ã€‚
2. Customï¼šæ‰‹åŠ¨å®šä¹‰ä¸€ç»„å¯é€‰é¡¹ï¼Œæ˜¯ä¸€ç»„ç”¨é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨ï¼Œè¿™äº›å€¼å°†ä½œä¸ºä¸‹æ‹‰èœå•çš„é€‰é¡¹ã€‚
3. Textboxï¼šæ·»åŠ ä¸€ä¸ªæ–‡æœ¬æ¡†ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ä»»æ„æ–‡æœ¬ã€‚
4. Constantï¼šå¸¸é‡ï¼Œåœ¨ä»ªè¡¨ç›˜çš„å˜é‡åŒºåŸŸä¸å¯è§ã€‚
5. Intervalï¼šå®šä¹‰ä¸€ç»„æ—¶é—´é—´éš”ï¼Œå¯ä»¥ç”¨äºæ›´æ”¹ä»ªè¡¨æ¿ä¸Šçš„æ—¶é—´èŒƒå›´æˆ–èšåˆçº§åˆ«ã€‚
6. Data sourceï¼šè¿™ç§ç±»å‹çš„å˜é‡åœ¨æœ‰å¤šä¸ªæ•°æ®æºæ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå…è®¸ç”¨æˆ·åŠ¨æ€åˆ‡æ¢æ•°æ®æºã€‚
7. Ad-hoc filtersï¼šåŠ¨æ€æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤è¿‡æ»¤æ¡ä»¶ï¼Œä»…æ”¯æŒæŸäº›æ•°æ®æºï¼Œå¦‚ ESã€InfluxDBã€‚



ä¸‹é¢å°†ä¾æ¬¡ä»‹ç»ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å˜é‡ç±»å‹ï¼š`Custom`ã€`Textbox`ã€`Query`



##### Custom

![image-20240121230253110](/media/grafana/image-20240121230253110.png)

* â‘ ï¼šæä¾›å‡ ä¸ªå›ºå®šçš„é€‰é¡¹ï¼Œé€—å·åˆ†éš”ã€‚

* â‘¡ï¼šé»˜è®¤å•é€‰ï¼Œå¯ä»¥æ”¯æŒå¤šé€‰ã€‚

* â‘¢ï¼šå½“å…è®¸å¤šé€‰æ—¶ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªâ€œå…¨é€‰â€çš„é€‰é¡¹ã€‚

* â‘£ï¼šâ€œå…¨é€‰â€çš„é»˜è®¤å€¼æ˜¯æ‰€æœ‰å€¼æ‹¼èµ·æ¥ï¼Œå¦‚`{value1, value2, ...}`ã€‚ å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå€¼ï¼Œå¦‚`*`ã€‚

* â‘¤ï¼šCustom å˜é‡çš„é€‰æ‹©æ¡†ä¹Ÿæ˜¯è¾“å…¥æ¡†ï¼Œå¯ä»¥ä¸´æ—¶è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨äºå›ºå®šé€‰é¡¹ä¸­çš„å€¼ï¼Œå¦‚ä¸‹å›¾ã€‚

<img src="/media/grafana/image-20240121230355503.png" alt="image-20240121230355503" style=";" />



##### Textbox

ç®€åŒ–ç‰ˆçš„ Customã€‚å°±æ˜¯ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œå¯ä»¥è¾“å…¥ä»»æ„å€¼ã€‚

![image-20240121230508338](/media/grafana/image-20240121230508338.png)



##### Query

Custom ç±»å‹çš„å˜é‡åªèƒ½æä¾›å›ºå®šçš„å€¼åˆ—è¡¨ï¼Œè€Œ Query ç±»å‹çš„å˜é‡å¯ä»¥**å®æ—¶æŸ¥è¯¢**æŸä¸ª metrics name ä¸‹çš„æŸä¸ª tag çš„å–å€¼ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯â€œè·å–æœåŠ¡çš„æ‰€æœ‰ä¸Šæ¸¸ / ä¸‹æ¸¸â€ã€‚

ä¸‹é¢ä»¥ OpenTSDB æ•°æ®æºä¸ºä¾‹ï¼Œæ¼”ç¤º Query ç±»å‹å˜é‡çš„ä½¿ç”¨æ–¹å¼ï¼š

![image-20240121230725233](/media/grafana/image-20240121230725233.png)

* â‘ ï¼šè¿™é‡Œæ˜¯ OpenTSDB æä¾›çš„æŸ¥è¯¢è¯­æ³•ï¼Œè¯¦è§[å®˜ç½‘](http://opentsdb.net/docs/build/html/user_guide/query/examples.html)ï¼Œä½œç”¨æ˜¯è·å– Metrics `throughput` ä¸‹çš„ tag `from` çš„æ‰€æœ‰å€¼ã€‚å…¶æ—¶é—´èŒƒå›´é»˜è®¤æ˜¯æœ€è¿‘ä¸€ä¸ªå°æ—¶ã€‚
* â‘¡ï¼šå»ºè®®å°†é€‰é¡¹åˆ—è¡¨è®¾ç½®ä¸º**å­—æ¯é¡ºåºæ’åˆ—**ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œé€‰æ‹©
* â‘¢ï¼šå¦‚æœ Query ä¸­ç”¨åˆ°äº†åˆ«çš„å˜é‡ï¼Œéœ€è¦å°†`Refresh`è®¾ç½®ä¸º`On Dashboard Load`æˆ–è€…`On Time Range Change`ã€‚



Query Options ä¸­çš„â€œ**Regex**â€å¯ä»¥ç”¨æ¥è¿‡æ»¤å­—æ®µã€‚æ¯”å¦‚åªä¿ç•™ `test_` å¼€å¤´çš„å€¼ï¼š

```
/^test_/
```

å¦å¤–ï¼Œç”¨æ­£åˆ™çš„æ•è·ç»„ï¼Œå¯ä»¥æŠŠ `test_` å‰ç¼€å»æ‰ï¼Œåªä¿ç•™åé¢çš„å†…å®¹ï¼š

```
/((?<=test_)*)/
```

å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼šQuery è¿”å›äº† `test_foo`å’Œ`test_bar`ï¼Œä½†éœ€è¦æå–å…¶ä¸­çš„ `foo` å’Œ `bar` ç”¨åœ¨ Panel ä¸­ã€‚

> <https://grafana.com/docs/grafana/latest/variables/filter-variables-with-regex/>



ğŸ’¡å»ºè®®ï¼š**èƒ½ç”¨ Query å°½é‡ä¸è¦ç”¨ Custom**ï¼Œè¿™æ ·èƒ½ä¿è¯çœ‹æ¿çš„é€šç”¨æ€§ã€‚
{: .ant-alert .ant-alert-info}

ğŸ’¡ åœ¨é…ç½® Panel æ—¶ï¼Œç»å¸¸ä¼šå‡ºç°`foo=*`è¿™æ ·çš„è¯­æ³•ï¼Œç”¨æ¥æšä¸¾`foo`çš„æ‰€æœ‰å¯èƒ½å–å€¼ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®å°†`foo`é…ç½®ä¸ºä¸€ä¸ª Query å˜é‡ï¼Œä½¿ç”¨`foo=${foo}`ã€‚ä¸ä»…é»˜è®¤æ•ˆæœä¸€æ ·ï¼Œå¿…è¦æ—¶è¿˜å¯ä»¥æŒ‰å€¼è¿‡æ»¤ä¸‹é’»ï¼Œé€æ­¥å®šä½é—®é¢˜ã€‚
{: .ant-alert .ant-alert-info}



#### å˜é‡é»˜è®¤å€¼

å¦‚ [1.7-ä¿å­˜çœ‹æ¿é»˜è®¤çŠ¶æ€](#default) æ‰€è¿°ï¼š

- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“é€‰æ‹©äº†æŸä¸ªå˜é‡åï¼Œå˜é‡çš„å€¼ä¼šé™„åœ¨ URL é‡Œï¼Œä»¥ `var-xxx` å¼€å¤´ï¼š
    ```plaintext
    https://play.grafana.org/d/fa06d46e-ad2f-462e-93b0-f96fdc77ba9a/grafana-play-home-copy-2?orgId=1&var-query0=123&from=1705823477666&to=1705824050985&var-foo=1233&var-bar=213&var-custom=1&var-custom=2&var-from=222
    ```


- ä¿å­˜çœ‹æ¿æ—¶ï¼Œä¼šæç¤ºæ˜¯å¦è¦ä¿å­˜å½“å‰é€‰æ‹©çš„å˜é‡å€¼ä½œä¸ºé»˜è®¤å€¼ï¼š

  ![image-20240121160835012](/media/grafana/image-20240121160835012.png)

- ä¿å­˜é»˜è®¤å€¼åï¼Œè®¿é—®ä¸æºå¸¦ä»»ä½•å‚æ•°çš„çœ‹æ¿é“¾æ¥ï¼š<https://play.grafana.org/d/000000012>ï¼Œå°±ä¼šè‡ªåŠ¨åŠ è½½å˜é‡çš„é»˜è®¤å€¼ã€‚

å› æ­¤ï¼Œå»ºè®®ä¿å­˜å˜é‡çš„é»˜è®¤å€¼ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé»˜è®¤å€¼éƒ½æ˜¯ `All`ï¼Œç„¶åè®©ç”¨æˆ·è‡ªå·±è¿‡æ»¤ã€‚æŸäº›å˜é‡å¯ä»¥è®¾ç½®æˆä¸€ä¸ªä¸»è¦çš„å€¼ï¼Œé¿å…é¢æ¿ä¸Šæ›²çº¿å¤ªå¤šï¼Œå¯¹ç”¨æˆ·äº§ç”Ÿå¹²æ‰°ã€‚æ¯”å¦‚ `cluster` é»˜è®¤è®¾ä¸º `default`ï¼Œä¸è¦æŠŠæµ‹è¯•é›†ç¾¤ä¹Ÿå‹¾é€‰ä¸Šã€‚




### 2. ä½¿ç”¨å˜é‡

#### åŸºæœ¬ä½¿ç”¨

ä½¿ç”¨å˜é‡çš„è¯­æ³•æ˜¯**`$varname`**æˆ–**`${varname}`**ã€‚æ¨èä½¿ç”¨åä¸€ç§ï¼Œå› ä¸ºåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œgrafana æ— æ³•æ­£ç¡®åŒºåˆ†å˜é‡åçš„è¾¹ç•Œï¼Œæ¯”å¦‚æŠŠ`$service.xxx.xxx`è¯†åˆ«æˆä¸€ä¸ªå˜é‡ï¼Œä½†å®é™…ä¸Šåº”è¯¥æ˜¯`$service`ã€‚

åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡ï¼š

- æ ‡é¢˜
- é“¾æ¥
- Query
- Alias
- Tags
- ...



#### å˜é‡ä¿®é¥°ç¬¦

å˜é‡ä¼šè¢«æ›¿æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å½“æŸä¸ªå˜é‡å¯ä»¥å¤šé€‰æ—¶ï¼ŒGranafa é»˜è®¤ä¼šç”Ÿæˆ`{foo,bar}`å½¢å¼çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥é€šè¿‡ä¿®é¥°ç¬¦æ§åˆ¶ç”Ÿæˆçš„å­—ç¬¦ä¸²å½¢å¼ã€‚

å¸¸ç”¨çš„ä¿®é¥°ç¬¦ï¼š

- `${var:pipe}`ï¼šç”Ÿæˆ`foo|bar`ã€‚è¿™ä¸ªæ˜¯ OpenTSDB tags èƒ½å¤Ÿè¯†åˆ«çš„è¯­æ³•ï¼Œå› æ­¤å»ºè®® tags ä¸­æ‰€æœ‰å˜é‡å€¼éƒ½å†™æˆ`:pipe`çš„å½¢å¼ã€‚
- `${var:queryparam}`ï¼šç”Ÿæˆ`var-name=foo&var-name=bar`ã€‚å¦‚æœå¸Œæœ›é€šè¿‡ URL ä¼ é€’å˜é‡ï¼Œéœ€è¦è¿™æ ·å†™ã€‚
- æ‰€æœ‰ä¿®é¥°ç¬¦è§ [Grafana æ–‡æ¡£](https://grafana.com/docs/grafana/latest/variables/advanced-variable-format-options/)ã€‚



#### å†…ç½®å˜é‡ / å…¨å±€å˜é‡

Grafana å†…ç½®äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œæ¯”å¦‚æ—¶é—´èŒƒå›´`$__from`ã€`$__to`ï¼Œæˆ–è€…`$__all_variables` (æ‰€æœ‰å˜é‡çš„å½“å‰å–å€¼ï¼Œè¡¨ç¤ºä¸º url query parameters å½¢å¼) ç­‰ã€‚è¯¦è§ [Grafana æ–‡æ¡£](https://grafana.com/docs/grafana/latest/variables/variable-types/global-variables/)ã€‚

å…¨å±€å˜é‡ä¹Ÿæ”¯æŒä¿®é¥°ç¬¦ã€‚`$__from`å’Œ`$__to`è¿˜æ”¯æŒå¦‚ä¸‹çš„æ—¥æœŸæ ¼å¼åŒ–è¯­æ³•ï¼š

![image-20240121232653652](/media/grafana/image-20240121232653652.png)

ğŸ’¡å…¸å‹ä½¿ç”¨åœºæ™¯ï¼šé…ç½®äº†è·³è½¬åˆ°å…¶ä»–çœ‹æ¿çš„é“¾æ¥ï¼Œå¸Œæœ›é™„å¸¦å½“å‰çœ‹æ¿çš„æ‰€æœ‰çŠ¶æ€ (å˜é‡å€¼ã€æ—¶é—´èŒƒå›´ç­‰)ã€‚
{: .ant-alert .ant-alert-info}

### 3. å˜é‡è”åŠ¨ / é”®å€¼å¯¹æ˜ å°„

å˜é‡è”åŠ¨æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­çš„å¸¸è§éœ€æ±‚ï¼Œä½†å½“å‰ Grafana æ²¡æ³•å¾ˆå¥½æ”¯æŒã€‚ä¸€ä¸ªå…¸å‹çš„åœºæ™¯æ˜¯æ ¹æ®åœ°åŒºé€‰æ‹©ç›¸åº”çš„æœåŠ¡å™¨ï¼š

```Plaintext
   A    |  B 
------- | -------
cn      | shanghai
us      | new_york, silicon
```

è§£å†³æ–¹æ³•æ˜¯ï¼š

* A é…ç½®æˆä¸€ä¸ª Custom å˜é‡ï¼Œå€¼æ˜¯ `cn, us`
* B é…ç½®æˆä¸€ä¸ª Query ç±»å‹çš„å˜é‡ï¼Œå€¼å½¢å¦‚ `Query($A)`

B çš„å…·ä½“è¯­æ³•ä¾èµ–äºé€‰æ‹©çš„æ•°æ®æºã€‚å¯ä»¥æŠŠ A â†’ B çš„æ˜ å°„å­˜åˆ° Prometheus ç­‰æ•°æ®åº“æ¥ç­›é€‰ï¼Œä½†è¿™æ ·æ¯”è¾ƒéº»çƒ¦ã€‚æ›´ç®€å•çš„æ–¹æ³•æ˜¯å®ç°ä¸€ä¸ªç±»ä¼¼ <httpbin.org> è¿™æ ·çš„ *Echo æœåŠ¡*ï¼Œå¹¶æ³¨å†Œä¸ºä¸€ä¸ªæ•°æ®æºã€‚è¿™ç§ Echo æœåŠ¡ä¼šå°†ä¼ é€’è¿‡æ¥çš„å‚æ•°åŸå°ä¸åŠ¨åœ°è¿”å›ï¼Œæ¯”å¦‚è®¿é—® <a href="https://httpbin.org/get?cn=shanghai&us=new_york&us=silicon">https://httpbin.org/get?cn=shanghai&us=new_york&us=silicon</a> ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š

```json
{
  "args": {
    "cn": "shanghai", 
    "us": [
      "new_york", 
      "silicon"
    ]
  }
}
```

ç„¶åä½¿ç”¨ `jsonPath: $.args[$A]` å°±èƒ½è·å–åˆ° A å¯¹åº”çš„ B çš„å€¼äº†ã€‚

> å…·ä½“å®ç°ç•¥ï¼Œæ¬¢è¿è¡¥å……ã€‚



### 4. å˜é‡å¾ªç¯ / Repeated

Grafana æä¾›äº† Repeated rows å’Œ Repeated Panels åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®å˜é‡çš„å€¼åŠ¨æ€å¤åˆ¶è¡Œæˆ–é¢æ¿çš„å¸ƒå±€ã€‚

ä»¥è¡Œé‡å¤ä¸ºä¾‹ã€‚åœ¨è¡Œæ ‡é¢˜æ—è¾¹ç‚¹å‡»é½¿è½®å›¾æ ‡ï¼Œæ‰“å¼€â€œRow Optionsâ€ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º "Repeat for" çš„é€‰é¡¹ã€‚åœ¨è¿™é‡Œé€‰æ‹©è¦æŒ‰å“ªä¸ªå˜é‡é‡å¤ï¼Œç„¶åä¿å­˜ã€‚

![image-20240121235350674](/media/grafana/image-20240121235350674.png)

ç„¶åè¿™ä¸€è¡Œä¾¿ä¼šæŒ‰ç…§è¯¥å˜é‡çš„å½“å‰å–å€¼é‡å¤å¤šæ¬¡ï¼Œè¡Œå†…çš„æ‰€æœ‰é¢æ¿å‡ä¼šè¢«å¤åˆ¶ã€‚åœ¨é‡å¤è¡Œå†…ï¼Œè®¿é—®é‡å¤å˜é‡å `$custom` å°†ä¼šè·å–åˆ°å•ä¸ªå€¼ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![image-20240121235543708](/media/grafana/image-20240121235543708.png)

![image-20240121235615376](/media/grafana/image-20240121235615376.png)





## ä¸‰ã€æ•°æ®æº Data Sources

### 1. OpenTSDB



### 2. Bosun



### 3. Grafana Test Data



## å››ã€ç•Œé¢ Rows / Panels

### 1. è¡Œ Rows

è¡Œï¼šæ ‡é¢˜



### 2. é¢æ¿ Panels

* æ“ä½œï¼šæ–°å»ºã€å¤åˆ¶ã€ç¼–è¾‘ã€ç§»åŠ¨
* é¢æ¿ï¼šæ ‡é¢˜ã€æè¿°ã€é“¾æ¥
* 





## äº”ã€å¯è§†åŒ– Visualizations

é™„å½•æœ‰å¾ˆå¤šç°æˆçš„ã€‚åˆ°æ—¶å€™ç›´æ¥ç”¨é‚£é‡Œçš„ç¤ºä¾‹ + é“¾æ¥ã€‚



### 1. Graph æŠ˜çº¿å›¾

è¿™æ˜¯æœ€é«˜é¢‘çš„ã€‚åœ¨è¿™é‡Œå°±ä»‹ç»å¤§éƒ¨åˆ†å†…å®¹



alias

override

* Series Override
* Y Axes

### 2. Pie é¥¼å›¾



### Bar ç›´æ–¹å›¾



### Gauge æ°´ä½çº¿



### Stat ç»Ÿè®¡



### Heatmap çƒ­åŠ›å›¾





#### Text / Markdown / HTML æ–‡æœ¬





å„ç§å¯è§†åŒ–ç±»å‹ã€é€‚ç”¨åœºæ™¯ã€é…ç½®é¡¹

1. * 





## å…­ã€é“¾æ¥ Links

é“¾æ¥

* ç±»å‹
* ä¼ é€’å˜é‡





## ä¸ƒã€äº¤äº’



annotation æ ‡è®°äº‹ä»¶ï¼š

![image-20230722232130876](/media/grafana/image-20230722232130876.png)



å¦‚ä½•è‡ªå·±æ’å…¥ä¸€äº›æ ‡è®°æ•°æ®ï¼Ÿå®ç°



## ----



### Grafana Dashboard Demo







**éå¸¸å»ºè®®è‡ªå·±ä½“éªŒï¼Œå†…å®¹éå¸¸ä¸°å¯Œï¼Œå¯ä»¥å­¦ä¹ åˆ° Grafana çš„æ‰€æœ‰åŠŸèƒ½**ï¼š

è€Œä¸”æœ¬æ–‡åªä¼šè¦†ç›–æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¸ä¼šè¦†ç›–æ‰€æœ‰åŠŸèƒ½ï¼ˆè§†é¢‘æ¼”ç¤ºå¯èƒ½ä¼šè¯´ï¼Œæ¯”å¦‚ Line çš„ Pointsï¼‰

ä¸‹é¢æ‘˜å½•äº†ä¸€äº›å¯ä»¥å‚è€ƒçš„ï¼ˆéƒ¨åˆ†å†…å®¹æ‹†åˆ†åˆ°åé¢çš„ ç« èŠ‚ é‡Œå§ï¼Œæ¯”å¦‚è¡¨æ ¼çš„æ¼”ç¤ºï¼Œå°±é…ä¸€ä¸ªè¡¨æ ¼çš„é“¾æ¥ + æˆªå›¾ï¼‰ï¼š

* å¯è§†åŒ– (ä¸€å›¾èƒœåƒè¨€)

  * [Time Series æ—¶åºå›¾ï¼ˆæŠ˜çº¿å›¾ï¼‰](https://play.grafana.org/d/000000016/1-time-series-graphs?orgId=1)ï¼šGraphite æ•°æ®æº

    * [æ¯ä¸ªé…ç½®é¡¹çš„ç»†èŠ‚](https://play.grafana.org/d/hxne1Hm4z/1-time-series-features-detailed-overview?orgId=1)ï¼šç‚¹å›¾ã€æŸ±å½¢å›¾ï¼›æ¸å˜ï¼›çº¿æ¡å®½åº¦ï¼›å¯¹é½ï¼›å¡«å……ï¼›å¤šä¸ª Y è½´ï¼›Series Onverrideï¼›Thresholdã€‚

  * [Demoï¼šæŸ±çŠ¶å›¾å’Œé¥¼å›¾](https://play.grafana.org/d/ktMs4D6Mk/5-bar-charts-and-pie-charts?orgId=1)

    ![image-20230722231210804](/media/grafana/image-20230722231210804.png)

  * [Piechart é¥¼å›¾](https://play.grafana.org/d/-Kj3rZdGz/piechart?orgId=1)

  * [Stat ç»Ÿè®¡](https://play.grafana.org/d/Zb3f4veGk/2-stats?orgId=1)ï¼šæ˜¾ç¤ºä¸€ä¸ªå½“å‰çš„å€¼

    ![image-20230722230754838](/media/grafana/image-20230722230754838.png)

  * [Gauge](https://play.grafana.org/d/KIhkVD6Gk/4-gauges?orgId=1&refresh=10s)ï¼šæ˜¾ç¤ºè´Ÿè½½æƒ…å†µï¼Œç›´è§‚åˆ¤æ–­æ˜¯å¦å¿«è¶…æ ‡äº†

    ![image-20230722231032773](/media/grafana/image-20230722231032773.png)

    * [Bar Gauge](https://play.grafana.org/d/vmie2cmWz/bar-gauge?orgId=1&refresh=10s)ï¼šæ°´å¹³ã€å‚ç›´ã€æ¸å˜ã€é˜ˆå€¼ã€‚æµ‹è¯•æ•°æ®é›†ã€‚

  * [Canvas ç”»å¸ƒ](https://play.grafana.org/d/7p7JkqWVz/panel-tests-canvas-examples?orgId=1)

  * Table è¡¨æ ¼ï¼šè¡¨æ ¼é‡Œçš„å•å…ƒæ ¼å¯ä»¥æ˜¯ä¸€ä¸ª Bar Gaugeï¼Œæˆ–è€…é…ç½®é¢œè‰²ã€‚ä½†æ„Ÿè§‰ä¸é€‚åˆæ—¶åºæ•°æ®å±•ç¤ºã€‚

    * [First Demo](https://play.grafana.org/d/OhR1ID6Mk/3-table?orgId=1)

      ![image-20230722231006430](/media/grafana/image-20230722231006430.png)

    * [Second Demo](https://play.grafana.org/d/U_bZIMRMk/table-panel-showcase?orgId=1)

    * [Third Demo](https://play.grafana.org/d/T512JVH7z/loki-nginx-service-mesh-json-version?orgId=1&var-datasource=LGTM%20Stack%20-%20Loki&var-label_name=filename&var-label_value=All&var-job=All&var-instance=All&viewPanel=6) ä¸æ˜¯æ—¶åºçš„ï¼Œå±•ç¤ºäº† Top 10 çš„è·¯å¾„

      ![image-20230722222016635](/media/grafana/image-20230722222016635.png)

  * [State timeline, Status history](https://play.grafana.org/d/qD-rVv6Mz/6-state-timeline-and-status-history?orgId=1)ï¼šæ˜¾ç¤ºæ¯ä¸ªæ—¶é—´æ®µè¾¾æ ‡ä¸å¦

    ![image-20230722231247157](/media/grafana/image-20230722231247157.png)

  * [Flow chart æµç¨‹å›¾](https://play.grafana.org/d/NpjdeVWGz/flowcharting-bug-draw-io-940?orgId=1)ï¼šå¯ä»¥ç”¨ Draw.io ç”»ã€‚å¯ä»¥ç›´æ¥åœ¨åµŒå…¥çš„é¡µé¢é‡Œç¼–è¾‘ã€‚æ‰€ä»¥å¯ä»¥ç”¨è¿™ä¸ªç”»ä¸€äº›å›¾ã€‚

    * [Second Demo](https://play.grafana.org/d/ubByxW2Gz/flowcharting-dc-floor?orgId=1)
    * [Third Demo](https://play.grafana.org/d/Kcic5xeWz/flowcharting-events-and-animations?orgId=1)
    * [å¯ä»¥å±•å¼€ã€æŠ˜å çš„ Demo](https://play.grafana.org/d/JG78lp0Zk/flowcharting-expand-and-collapse?orgId=1)
    * [é¼ æ ‡æµ®åœ¨å›¾ç‰‡ä¸Šï¼Œèƒ½çœ‹åˆ°å¯¹åº”çš„ Metrics æ•°æ®](https://play.grafana.org/d/yNQz3OCZk/flowcharting-floorplan?orgId=1&refresh=30s)
    * [æ¶æ„å›¾](https://play.grafana.org/d/p5F-FKCZk/flowcharting-technical-architecture?orgId=1)
    * å…¶å®è¿™äº›éƒ½æ˜¯ draw.io çš„ Demo äº†

* æ•°æ®æº

  * [TestData (Mock æ•°æ®æº)](https://play.grafana.org/d/cd9f6101-da97-497b-93ec-0ef39a2d3c64/cursor-sync?orgId=1)

    https://grafana.com/docs/grafana/latest/datasources/testdata/

    > ä½†æ˜¯ Alias æ€ä¹ˆç”¨ï¼Ÿå¥½åƒåªèƒ½æ˜¯ä¸åŒçš„ Query äº†
    >
    > __house_locations å¯ä»¥æŒ‡å®šåå­—ï¼Œä½†ä¸çŸ¥é“æœ‰å“ªäº› alias

    * Random Walkï¼šéšæœºæ•°ï¼Œå¯ä»¥æŒ‡å®š Series num

    * Slow Queryï¼šæŒ‡å®šè¿”å›æ•°æ®çš„è€—æ—¶

    * CSV Contextï¼šè‡ªå·±ç²˜è´´ä¸€ä¸ª CSV æ•°æ®ï¼Œæ¯”å¦‚

      ```csv
      Name,Value,Unit,Color
      Temperature,10,degree,green
      Pressure,100,bar,blue
      Speed,30,km/h,red
      ```

      è¿™é‡Œè¦åšä¸€ä¸ª Transformï¼Œé…ç½® time fieldï¼ˆconvert field typeï¼‰

  * [InfluxDB 2](https://play.grafana.org/d/play-influx-internal/influx-2-2-internal-metrics?orgId=1)

    ```influx
    from(bucket: "grafana")
      |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
      |> filter(fn: (r) => r._measurement == "boltdb_reads_total" or r._measurement == "boltdb_writes_total")
      |> filter(fn: (r) => r._field == "counter")
      |> derivative(unit: v.windowPeriod, nonNegative: true)
      |> aggregateWindow(every: v.windowPeriod, fn: mean, createEmpty: false)
      |> drop(columns: ["_field"])
      |> yield(name: "derivative")
    ```

  * [Github Pull Requests](https://play.grafana.org/d/e8d69de7-88a1-4749-9a41-7f708c918824/pull-requests-external?orgId=1)

  * [Github](https://play.grafana.org/d/iVcSTeyG2/)ï¼šè¿™ä¸ªæ•°æ®æºçœŸèƒ½æŸ¥è‡ªå·±çš„ä»“åº“ï¼Œä½†æ•°æ®æ˜¾ç¤ºæœ‰é—®é¢˜ï¼Œå› ä¸º token ç¼ºä¹æƒé™

  * [OpenTSDB](https://play.grafana.org/d/play-opentsdb-cpu/opentsdb?orgId=1&refresh=1m)ï¼šå­—èŠ‚çš„ Metrics ç”¨çš„æ˜¯è¿™ä¸ªæ•°æ®æº

    * tag_names(proc.loadavg.1m)ï¼šæ²¡æœ‰åˆ«çš„ key

* Panel Options

  * Axes

    * [å¯¹æ•° Scale](https://play.grafana.org/d/000000040/logarithmic-scales?orgId=1&editPanel=1)

  * [Threshold](https://play.grafana.org/d/000000167/threshold-example?orgId=1)

  * [Time Range Override](https://play.grafana.org/d/000000041/time-range-override?orgId=1)ï¼šå±•ç¤ºå’Œå³ä¸Šè§’é€‰æ‹©æ—¶é—´èŒƒå›´ä¸åŒçš„æ•°æ®

    ![image-20230722225237898](/media/grafana/image-20230722225237898.png)

* Repeat

  * [Repeat Rows](https://play.grafana.org/d/000000153/repeat-rows?orgId=1)
    * [é‡å¤çš„ Row é‡Œï¼ŒåµŒå¥—ä¸€ä¸ªæ°´å¹³é‡å¤çš„ Panel](https://play.grafana.org/d/k3PEoCpnk/repeating-a-row-with-a-non-repeating-panel-and-horizontal-repeating-panel?orgId=1)
    * [é‡å¤çš„ Row é‡Œï¼ŒåµŒå¥—ä¸€ä¸ªå‚ç›´é‡å¤çš„ Panel](https://play.grafana.org/d/7lS-ojt7z/repeating-a-row-with-a-non-repeating-panel-and-vertical-repeating-panel?orgId=1)
  * [Repeat Panels](https://play.grafana.org/d/000000025)ï¼šPanel options â†’ Repeat options
    * [æ°´å¹³é‡å¤](https://play.grafana.org/d/WVpf2jp7z/repeating-a-panel-horizontally?orgId=1)
    * [å‚ç›´é‡å¤](https://play.grafana.org/d/OY8Ghjt7k/repeating-a-panel-vertically?orgId=1)

* Variables å˜é‡

  * [å†…ç½®å…¨å±€å˜é‡](https://play.grafana.org/d/HYaGDGIMk/templating-global-variables-and-interpolation?orgId=1)

    * å°‘äº†æ—¶é—´ `${start?}` å«å•¥æ¥ç€

  * [Templated dynamic dashboard](https://play.grafana.org/d/000000056/)ï¼šåŸºäºå˜é‡å®ç°çš„åŠ¨æ€çœ‹æ¿ã€‚å˜é‡çš„å€¼æ¥è‡ª Graphite Queryã€‚

    * ä¹Ÿå¯ä»¥æ˜¯å…¶ä»– Queryã€‚

  * [Template VariablesFormatting Options](https://play.grafana.org/d/cJtIfcWiz/template-variable-formatting-options?orgId=1)ï¼šæ¨¡æ¿å˜é‡æ ¼å¼åŒ–ï¼Œä¿®æ”¹ `servers` å˜é‡ï¼ŒæŸ¥çœ‹æ•ˆæœ

    ![image-20230722221428085](/media/grafana/image-20230722221428085.png)

    å°‘äº†ä¸€ä¸ª `queryparam`

* Demo

  * [Grafana Dashboard](https://play.grafana.org/d/3SWXxreWk/grafana-dashboard?orgId=1)ï¼šæŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€Bar Gaugeã€‚Graphite æ•°æ®é›†ã€‚

    ![image-20230722170943238](/media/grafana/image-20230722170943238.png)

  * [Stats Overview](https://play.grafana.org/d/cL5pLH7Wz/stats-overview?orgId=1)ï¼šæŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€Gauge ä»ªè¡¨ç›˜ã€Bar Gaugeã€Statã€‚

  * [Big Dashboard](https://play.grafana.org/d/000000045/big-dashboard?orgId=1)ï¼šæŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€å †å ã€ç»Ÿè®¡ã€‚Graphite æ•°æ®é›†ã€‚

  * [Loki NGINX Service Mesh](https://play.grafana.org/d/T512JVH7z/)ï¼šæŠ˜çº¿å›¾ã€Statã€Gaugeã€Mapã€Log æ—¥å¿—ã€Table (å†…åµŒ Gauge)ã€‚

  * [Business Metrics](https://play.grafana.org/d/000000110/business-metrics?orgId=1)ï¼šStat ç»Ÿè®¡ã€é˜ˆå€¼ã€‚

  * [Multiple Panel Test Example](https://play.grafana.org/d/d5dd0b9e-6c85-40dc-ad57-a2f703f3b92a/public-dashboards-multiple-panel-test-example?orgId=1)ï¼šæ‰€æœ‰ç±»å‹çš„çœ‹æ¿é€Ÿè§ˆï¼ŒåŒ…æ‹¬ Textã€Geomapã€State timeline (è¿™ä¸ªè¿˜æŒºé€‚åˆç”¨æ¥çœ‹ä¸åŒæœºæˆ¿çš„ SLO æƒ…å†µçš„)ã€Logsã€Histogramã€Heatmapã€Gaugeã€Pie chartã€Tableã€Time Seriesã€Statã€Bar chartã€‚

  * [Kubernetes æœåŠ¡èµ„æºåˆ©ç”¨ç‡](https://play.grafana.org/d/a87fb0d919ec0ea5f6543124e16c42a5/kubernetes-compute-resources-namespace-workloads?orgId=1&refresh=30s)

  * Grafana ç»Ÿè®¡ï¼š

    * [ç¤¾åŒºç»Ÿè®¡](https://play.grafana.org/d/6Hg9LVd4z/grafana-community-forum-category-response-rate?orgId=1)ï¼šStat ç»Ÿè®¡ã€æŸ±çŠ¶å›¾ã€è¡¨æ ¼ (ç¿»é¡µ)ã€‚

      ![image-20230722222753922](/media/grafana/image-20230722222753922.png)

    * [Bugs ä¿®å¤æƒ…å†µ](https://play.grafana.org/d/YsxM0QQMz/grafana-bug-squash?orgId=1)

    * [Issues & PRs ç»Ÿè®¡](https://play.grafana.org/d/aw0AkS5Gz/grafana-issue-triage?orgId=1)
  
  
    * [HTTP ç«™ç‚¹ç¨³å®šæ€§ç›‘æ§](https://play.grafana.org/d/T512JVH7z/)ï¼šæµé‡ã€é”™è¯¯ç ã€å¸¦å®½ã€æ—¥å¿—ã€çƒ­ç‚¹è·¯å¾„ã€‚
  
    ![image-20230722170913944](/media/grafana/image-20230722170913944.png)

ï¼ˆæœ¬æ–‡æ˜¯ä¸€ä¸ªç®€ä»‹ + é€ŸæŸ¥æ‰‹å†Œï¼‰



æœ‰ä¸åŒ Data Source çš„ Demo

OpenTSDB çš„ï¼šhttps://play.grafana.org/d/play-opentsdb-cpu/opentsdb











## ## è®¾ç½®







## æ€»ç»“

Tips



## é™„å½•

### æœåŠ¡ç›‘æ§é¢æ¿åº”è¯¥å¦‚ä½•å»ºè®¾



### å®Œæ•´çš„æœåŠ¡çœ‹æ¿ç¤ºä¾‹

è¿™é‡ŒåŸºäº Test Data å’Œæ²™ç›’ï¼Œå¤åˆ» SRE Grafana

