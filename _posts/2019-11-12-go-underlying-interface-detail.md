---
layout: post
title: ğŸ“—ã€Go åŸç†ã€‘è¯¦è§£ interface
date: 2019/11/12 19:00
permalink: 2019/11/12/go-underlying-interface-detail.html
---

## æ¥å£ç±»å‹
Go è¯­è¨€æœ‰ä¸¤ç§æ¥å£ç±»å‹ï¼Œä¸€ç§æ˜¯å¸¦æœ‰æ–¹æ³•çš„æ¥å£ï¼Œé€šè¿‡ `type Name interface {}` å£°æ˜ï¼Œè¡¨ç¤ºä¸º `iface` ç»“æ„ä½“ï¼›å¦ä¸€ç§æ˜¯ä¸å¸¦æœ‰ä»»ä½•æ–¹æ³•çš„ `interface{}` ç±»å‹ï¼Œè¡¨ç¤ºä¸º `eface` ç»“æ„ä½“ã€‚

## æ¥å£ç±»å‹çš„åº•å±‚å®ç°
[ã€Go åŸç†ã€‘è¯¦è§£ nil]({% post_url 2019-11-12-go-underlying-nil-detail %}) ä¸­è¯´é“ï¼š
> åœ¨åº•å±‚ï¼Œinterface ä½œä¸ºä¸¤ä¸ªæˆå‘˜æ¥å®ç°ï¼šä¸€ä¸ªç±»å‹å’Œä¸€ä¸ªå€¼ `(type, value)`ã€‚æ¯”å¦‚å¯¹äº int å€¼ 3ï¼Œ ä¸€ä¸ªæ¥å£å€¼ç¤ºæ„æ€§åœ°åŒ…å« `(int, 3)`ã€‚
> 
> æ¥å£çš„é›¶å€¼æ˜¯ `(nil, nil)`ï¼Œåªæœ‰è¯¥æ¥å£å†…éƒ¨çš„å€¼å’Œç±»å‹éƒ½æ˜¯ `nil` æ—¶å®ƒæ‰ç­‰äº `nil`ã€‚

è¿™å…¶å®æ˜¯ä¸€ç§æ¯”è¾ƒç¬¼ç»Ÿçš„è¯´æ³•ã€‚å¯¹äºå¸¦æœ‰æ–¹æ³•çš„æ¥å£ç±»å‹å’Œä¸å¸¦ä»»ä½•æ–¹æ³•çš„ `interface{}` ç±»å‹ï¼Œåº•å±‚å®ç°æœ‰æ‰€åŒºåˆ«ã€‚

ä¸å¸¦ä»»ä½•æ–¹æ³•çš„ `interface{}` ç±»å‹åº•å±‚å®ç°ä¸º `eface` ç»“æ„ä½“ï¼š
```go
type eface struct { // 16 bytes
    _type *_type
    data  unsafe.Pointer
}
```
å…¶ä¸­ç¬¬ä¸€ä¸ªå­—æ®µæŒ‡å‘åº•å±‚ç±»å‹ï¼Œç¬¬äºŒä¸ªå­—æ®µæŒ‡å‘åº•å±‚æ•°æ®(å…·ä½“å€¼ï¼‰ã€‚

è€Œå¸¦æœ‰æ–¹æ³•çš„æ¥å£ç±»å‹åº•å±‚å®ç°ä¸º `iface` ç»“æ„ä½“ï¼š
```go
ype iface struct { // 16 bytes
    tab  *itab
    data unsafe.Pointer
}
```
å…¶ä¸­ç¬¬äºŒä¸ªå­—æ®µåŒæ ·æŒ‡å‘åº•å±‚æ•°æ®(å…·ä½“å€¼ï¼‰ï¼Œç¬¬ä¸€ä¸ªå­—æ®µé™¤äº†åŒ…å«åº•å±‚ç±»å‹å¤–ï¼Œè¿˜åŒ…å«æ›´ä¸°å¯Œçš„ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ `itab` ç»“æ„ä½“çš„å®šä¹‰ï¼š
```go
type itab struct { // 32 bytes
    inter *interfacetype
    _type *_type
    hash  uint32 // copy of _type.hash. Used for type switches.
    _     [4]byte
    fun   [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.
}
```
* `_type` å°±æ˜¯æ¥å£çš„åº•å±‚ç±»å‹
* `hash` å­—æ®µæ˜¯ `_type.hash` çš„æ‹·è´ï¼Œç”¨äºå°† interface è½¬æ¢ä¸ºå…·ä½“ç±»å‹æ—¶å¿«é€Ÿåˆ¤æ–­ç›®æ ‡ç±»å‹å’Œæ¥å£çš„åº•å±‚ç±»å‹æ˜¯å¦ä¸€è‡´
* `inter` æè¿°æ¥å£ç±»å‹
* `fun` æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘å…·ä½“ç±»å‹ `_type` å®ç°çš„å…·ä½“æ–¹æ³•ï¼Œåœ¨é€šè¿‡ä¸€ä¸ªæ¥å£å»è°ƒç”¨æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šåœ¨è¿™ä¸ªè¡¨æ ¼ä¸­æŸ¥æ‰¾ï¼Œç„¶åä½¿ç”¨å…·ä½“å€¼å»è°ƒç”¨æ­£ç¡®çš„æ–¹æ³•ã€‚å¦‚æœè¯¥æ•°ç»„ä¸ºç©ºè¡¨ç¤ºç±»å‹ `_type` æ²¡æœ‰å®ç° `inter` æ¥å£

å†å›å¤´è¯´ä¸€ä¸‹æ¥å£ç±»å‹çš„ç¬¬äºŒä¸ªå­—æ®µ `data`ã€‚å¦‚æœæ¥å£ç±»å‹çš„å…·ä½“å€¼æ˜¯ä¸€ä¸ªå€¼ç±»å‹ï¼Œé‚£ä¹ˆ data æŒ‡å‘çš„æ˜¯å…·ä½“å€¼çš„æ‹·è´ï¼›å¦åˆ™ï¼Œdata æŒ‡å‘å…·ä½“å€¼çš„åœ°å€ã€‚ä»¥ file ç±»å‹å’Œ Reader æ¥å£ä¸ºä¾‹ï¼š
```go
f := file.Open('...')
var reader Reader = f.reader()
```
`reader` å˜é‡åº•å±‚çš„ `data` å­—æ®µå®é™…æŒ‡å‘çš„æ˜¯ f çš„ä¸€ä¸ªå‰¯æœ¬ã€‚

---
å‚è€ƒèµ„æ–™ï¼š
* [æµ…è°ˆ Go è¯­è¨€å®ç°åŸç† Â· 2.2 æ¥å£ - draveness](https://draveness.me/golang/basic/golang-interface.html)